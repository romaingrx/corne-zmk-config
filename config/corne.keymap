/*
 * MIRYOKU LAYOUT - QWERTY VARIANT
 * For Corne 3x5+3 Split Keyboard
 *
 * This is a standalone implementation of the Miryoku layout with QWERTY alphas
 * Based on: https://github.com/manna-harbour/miryoku
 *
 * LAYOUT PHILOSOPHY:
 * - 36 keys total (30 alphas + 6 thumb keys)
 * - Home row modifiers (mod-tap keys)
 * - Layer-tap on thumbs for accessing additional layers
 * - Maximum 1-unit finger travel from home position
 * - Layers accessed by holding opposite hand thumb key
 *
 * LAYERS:
 * 0. BASE   - QWERTY alphas with home row mods
 * 1. NAV    - Navigation, editing (arrows, home/end, etc.)
 * 2. MOUSE  - Mouse emulation
 * 3. MEDIA  - Media controls, RGB, Bluetooth
 * 4. NUM    - Numbers and symbols (numpad-style)
 * 5. SYM    - Shifted symbols
 * 6. FUN    - Function keys F1-F12
 *
 * THUMB KEY ASSIGNMENTS:
 * Left:  ESC (Media) | SPACE (Nav) | TAB (Mouse)
 * Right: ENTER (Sym) | BACKSPACE (Num) | DELETE (Fun)
 *
 * HOME ROW MODS (tap for letter, hold for modifier):
 * Left:  A=GUI | S=ALT | D=CTRL | F=SHIFT
 * Right: J=SHIFT | K=CTRL | L=ALT | ;=GUI
 *
 * TAPPING TERM: 200ms (adjust to your preference)
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>
#include <dt-bindings/zmk/mouse.h>

// Layer definitions
#define BASE   0
#define NAV    1
#define MOUSE  2
#define MEDIA  3
#define NUM    4
#define SYM    5
#define FUN    6

// Behavior configuration
&mt {
    tapping-term-ms = <200>;
    flavor = "tap-preferred";
};

&lt {
    tapping-term-ms = <200>;
    flavor = "tap-preferred";
};

/ {
    behaviors {
        // Home row mods (mod-tap)
        hml: homerow_mods_left {
            compatible = "zmk,behavior-hold-tap";
            #binding-cells = <2>;
            tapping-term-ms = <200>;
            quick-tap-ms = <175>;
            require-prior-idle-ms = <150>;
            flavor = "balanced";
            bindings = <&kp>, <&kp>;
            hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 32 33 34>;  // Right hand + thumbs
            hold-trigger-on-release;
        };

        hmr: homerow_mods_right {
            compatible = "zmk,behavior-hold-tap";
            #binding-cells = <2>;
            tapping-term-ms = <200>;
            quick-tap-ms = <175>;
            require-prior-idle-ms = <150>;
            flavor = "balanced";
            bindings = <&kp>, <&kp>;
            hold-trigger-key-positions = <0 1 2 3 4 10 11 12 13 14 20 21 22 23 24 30 31 32>;  // Left hand + thumbs
            hold-trigger-on-release;
        };
    };

    keymap {
        compatible = "zmk,keymap";

        /*
         * BASE LAYER (QWERTY)
         * ┌─────┬─────┬─────┬─────┬─────┐     ┌─────┬─────┬─────┬─────┬─────┐
         * │  Q  │  W  │  E  │  R  │  T  │     │  Y  │  U  │  I  │  O  │  P  │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │  A  │  S  │  D  │  F  │  G  │     │  H  │  J  │  K  │  L  │  ;  │
         * │ GUI │ ALT │CTRL │SHFT │     │     │     │SHFT │CTRL │ ALT │ GUI │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │  Z  │  X  │  C  │  V  │  B  │     │  N  │  M  │  ,  │  .  │  /  │
         * └─────┴─────┴─────┴──┬──┴──┬──┴─┐ ┌─┴──┬──┴──┬──┴─────┴─────┴─────┘
         *                      │ ESC │ SPC │ │ ENT │ BSPC│ DEL │
         *                      │Media│ Nav │ │ Sym │ Num │ Fun │
         *                      │  3  │  1  │ │  5  │  4  │  6  │
         *                      └─────┴─────┘ └─────┴─────┴─────┘
         */
        base_layer {
            display-name = "BASE";
            bindings = <
                &kp Q           &kp W           &kp E            &kp R            &kp T              &kp Y        &kp U            &kp I            &kp O           &kp P
                &hml LGUI A     &hml LALT S     &hml LCTRL D     &hml LSHFT F     &kp G              &kp H        &hmr RSHFT J     &hmr RCTRL K     &hmr RALT L     &hmr RGUI SEMI
                &kp Z           &kp X           &kp C            &kp V            &kp B              &kp N        &kp M            &kp COMMA        &kp DOT         &kp SLASH
                                                &lt MEDIA ESC    &lt NAV SPACE    &lt MOUSE TAB      &lt SYM RET  &lt NUM BSPC     &lt FUN DEL
            >;
        };

        /*
         * NAV LAYER (Navigation & Editing)
         * ┌─────┬─────┬─────┬─────┬─────┐     ┌─────┬─────┬─────┬─────┬─────┐
         * │     │     │     │     │     │     │ Redo│Paste│ Copy│ Cut │ Undo│
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │ GUI │ ALT │CTRL │SHFT │     │     │Caps │  ←  │  ↓  │  ↑  │  →  │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │     │     │     │     │     │     │ Ins │ Home│ PgDn│ PgUp│ End │
         * └─────┴─────┴─────┴──┬──┴──┬──┴─┐ ┌─┴──┬──┴──┬──┴─────┴─────┴─────┘
         *                      │     │HLD │ │ ENT │ BSPC│ DEL │
         *                      └─────┴─────┘ └─────┴─────┴─────┘
         */
        nav_layer {
            display-name = "NAV";
            bindings = <
                &none       &none       &none        &none        &none            &kp K_REDO   &kp K_PASTE  &kp K_COPY   &kp K_CUT    &kp K_UNDO
                &kp LGUI    &kp LALT    &kp LCTRL    &kp LSHFT    &none            &kp CAPS     &kp LEFT     &kp DOWN     &kp UP       &kp RIGHT
                &none       &none       &none        &none        &none            &kp INS      &kp HOME     &kp PG_DN    &kp PG_UP    &kp END
                                        &none        &none        &none            &kp RET      &kp BSPC     &kp DEL
            >;
        };

        /*
         * MOUSE LAYER (Mouse Emulation)
         * ┌─────┬─────┬─────┬─────┬─────┐     ┌─────┬─────┬─────┬─────┬─────┐
         * │     │     │     │     │     │     │ Redo│Paste│ Copy│ Cut │ Undo│
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │ GUI │ ALT │CTRL │SHFT │     │     │     │ Ms ←│ Ms ↓│ Ms ↑│ Ms →│
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │     │     │     │     │     │     │     │ Wh ←│ Wh ↓│ Wh ↑│ Wh →│
         * └─────┴─────┴─────┴──┬──┴──┬──┴─┐ ┌─┴──┬──┴──┬──┴─────┴─────┴─────┘
         *                      │     │     │ │ Btn1│ Btn3│ Btn2│
         *                      └─────┴─────┘ └─────┴─────┴─────┘
         */
        mouse_layer {
            display-name = "MOUSE";
            bindings = <
                &none       &none       &none        &none        &none            &kp K_REDO     &kp K_PASTE     &kp K_COPY      &kp K_CUT       &kp K_UNDO
                &kp LGUI    &kp LALT    &kp LCTRL    &kp LSHFT    &none            &none          &none           &none           &none           &none
                &none       &none       &none        &none        &none            &none          &none           &none           &none           &none
                                        &none        &none        &none            &none          &none           &none
            >;
        };

        /*
         * MEDIA LAYER (Media Controls, RGB, Bluetooth)
         * ┌─────┬─────┬─────┬─────┬─────┐     ┌─────┬─────┬─────┬─────┬─────┐
         * │     │     │     │     │     │     │ RGB │ RGB │ RGB │ RGB │ RGB │
         * │     │     │     │     │     │     │ TOG │ HUI │ SAI │ BRI │ EFF │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │ GUI │ ALT │CTRL │SHFT │     │     │     │ Prev│ Vol-│ Vol+│ Next│
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │     │     │     │     │     │     │ BT 0│ BT 1│ BT 2│ BT 3│ BT 4│
         * └─────┴─────┴─────┴──┬──┴──┬──┴─┐ ┌─┴──┬──┴──┬──┴─────┴─────┴─────┘
         *                      │ HLD │     │ │ Stop│Pause│ Mute│
         *                      └─────┴─────┘ └─────┴─────┴─────┘
         */
        media_layer {
            display-name = "MEDIA";
            bindings = <
                &none       &none       &none        &none        &none            &none            &none            &none            &none            &none
                &kp LGUI    &kp LALT    &kp LCTRL    &kp LSHFT    &none            &none            &kp C_PREV       &kp C_VOL_DN     &kp C_VOL_UP     &kp C_NEXT
                &none       &none       &none        &none        &none            &bt BT_SEL 0     &bt BT_SEL 1     &bt BT_SEL 2     &bt BT_SEL 3     &bt BT_SEL 4
                                        &none        &none        &none            &kp C_STOP       &kp C_PP         &kp C_MUTE
            >;
        };

        /*
         * NUM LAYER (Numbers & Symbols - Numpad Style)
         * ┌─────┬─────┬─────┬─────┬─────┐     ┌─────┬─────┬─────┬─────┬─────┐
         * │  [  │  7  │  8  │  9  │  ]  │     │     │     │     │     │     │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │  ;  │  4  │  5  │  6  │  =  │     │     │SHFT │CTRL │ ALT │ GUI │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │  `  │  1  │  2  │  3  │  \  │     │     │     │     │     │     │
         * └─────┴─────┴─────┴──┬──┴──┬──┴─┐ ┌─┴──┬──┴──┬──┴─────┴─────┴─────┘
         *                      │  .  │  0  │ │     │ HLD │     │
         *                      └─────┴─────┘ └─────┴─────┴─────┘
         */
        num_layer {
            display-name = "NUM";
            bindings = <
                &kp LBKT    &kp N7      &kp N8       &kp N9       &kp RBKT         &none        &none        &none        &none       &none
                &kp SEMI    &kp N4      &kp N5       &kp N6       &kp EQUAL        &none        &kp RSHFT    &kp RCTRL    &kp RALT    &kp RGUI
                &kp GRAVE   &kp N1      &kp N2       &kp N3       &kp BSLH         &none        &none        &none        &none       &none
                                        &kp DOT      &kp N0       &kp MINUS        &none        &none        &none
            >;
        };

        /*
         * SYM LAYER (Shifted Symbols)
         * ┌─────┬─────┬─────┬─────┬─────┐     ┌─────┬─────┬─────┬─────┬─────┐
         * │  {  │  &  │  *  │  (  │  }  │     │     │     │     │     │     │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │  :  │  $  │  %  │  ^  │  +  │     │     │SHFT │CTRL │ ALT │ GUI │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │  ~  │  !  │  @  │  #  │  |  │     │     │     │     │     │     │
         * └─────┴─────┴─────┴──┬──┴──┬──┴─┐ ┌─┴──┬──┴──┬──┴─────┴─────┴─────┘
         *                      │  (  │  )  │ │ HLD │     │     │
         *                      └─────┴─────┘ └─────┴─────┴─────┘
         */
        sym_layer {
            display-name = "SYM";
            bindings = <
                &kp LBRC    &kp AMPS    &kp STAR     &kp LPAR     &kp RBRC         &none        &none        &none        &none       &none
                &kp COLON   &kp DLLR    &kp PRCNT    &kp CARET    &kp PLUS         &none        &kp RSHFT    &kp RCTRL    &kp RALT    &kp RGUI
                &kp TILDE   &kp EXCL    &kp AT       &kp HASH     &kp PIPE         &none        &none        &none        &none       &none
                                        &kp LPAR     &kp RPAR     &kp UNDER        &none        &none        &none
            >;
        };

        /*
         * FUN LAYER (Function Keys F1-F12)
         * ┌─────┬─────┬─────┬─────┬─────┐     ┌─────┬─────┬─────┬─────┬─────┐
         * │ F12 │ F7  │ F8  │ F9  │PrtSc│     │     │     │     │     │     │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │ F11 │ F4  │ F5  │ F6  │ScrLk│     │     │SHFT │CTRL │ ALT │ GUI │
         * ├─────┼─────┼─────┼─────┼─────┤     ├─────┼─────┼─────┼─────┼─────┤
         * │ F10 │ F1  │ F2  │ F3  │Pause│     │     │     │     │     │     │
         * └─────┴─────┴─────┴──┬──┴──┬──┴─┐ ┌─┴──┬──┴──┬──┴─────┴─────┴─────┘
         *                      │ App │ Spc │ │     │     │ HLD │
         *                      └─────┴─────┘ └─────┴─────┴─────┘
         */
        fun_layer {
            display-name = "FUN";
            bindings = <
                &kp F12     &kp F7      &kp F8       &kp F9       &kp PSCRN        &none        &none        &none        &none       &none
                &kp F11     &kp F4      &kp F5       &kp F6       &kp SLCK         &none        &kp RSHFT    &kp RCTRL    &kp RALT    &kp RGUI
                &kp F10     &kp F1      &kp F2       &kp F3       &kp PAUSE_BREAK  &none        &none        &none        &none       &none
                                        &kp K_APP    &kp SPACE    &kp TAB          &none        &none        &none
            >;
        };
    };
};
